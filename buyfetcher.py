import requests as req
import time
from datetime import datetime
from colorama import Fore
import os


os.system("")

userinput = str(input("Enter the item_id (UPPERCASE!) you want to request- "))

TextColBuy=Fore.RED
TextColSell=Fore.GREEN
changeBuy = 0
changeBuyOld = 0
changeSell = 0
changeSellOld = 0

  
#read webhook from file
webhookurlfile= open("webhook.txt","r")
webhookurl=webhookurlfile.read()
webhookurlfile.close()



#apikey
while True:
    #api request !!!DONT TOUCH!!!
    bazaar = req.get("https://api.hypixel.net/skyblock/bazaar?key=865b2506-9e10-4f9c-9e4d-df99272960ec").json()

    #Calculate pirce change
    changeBuy=(bazaar['products'][userinput]['quick_status']['buyPrice'])-changeBuyOld
    changeSell=(bazaar['products'][userinput]['quick_status']['sellPrice'])-changeSellOld

    
    #Webhook message content
    embed = {
        "description": "Instabuy: " + str(bazaar['products'][userinput]['quick_status']['buyPrice']) + " | Change: " + str(round(changeBuy, 3)) + "\n" + "Instasell: " + str(bazaar['products'][userinput]['quick_status']['sellPrice']) + " | Change: " + str(round(changeSell, 3)) + "\n" + "Sellorders: " + str(bazaar['products'][userinput]['quick_status']['sellOrders']),
        "title": userinput
    }

    data = {
    "embeds": [
        embed
    ]
    }

    #send message to webhook
    result = req.post(webhookurl, json = data)

    if changeBuy<=0:
        TextColBuy=Fore.GREEN
    else:
        TextColBuy=Fore.RED

    if changeSell>=0:
        TextColSell=Fore.GREEN
    else:
        TextColSell=Fore.RED

    #Print
    print(userinput + ":")
    print("Instabuy: " + str(bazaar['products'][userinput]['quick_status']['buyPrice']) + " | Change: " + TextColBuy + str(round(changeBuy, 3)) + Fore.WHITE)
    print("Instasell: " + str(bazaar['products'][userinput]['quick_status']['sellPrice']) + " | Change: " + TextColSell + str(round(changeSell, 3)) + Fore.WHITE)

    print("Sellorders: " + str(bazaar['products'][userinput]['quick_status']['sellOrders']))
    
    #set changes
    changeBuyOld=bazaar['products'][userinput]['quick_status']['buyPrice']
    changeSellOld=bazaar['products'][userinput]['quick_status']['sellPrice']

    time.sleep(60)

